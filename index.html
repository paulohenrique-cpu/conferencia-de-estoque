<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockControl Pro - Sistema de Controle de Estoque</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .sidebar-item:hover { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .gradient-bg { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .status-ok { background: #10b981; color: white; }
        .status-baixo { background: #f59e0b; color: white; }
        .status-critico { background: #ef4444; color: white; }
        .animate-fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .file-drop-zone {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        .file-drop-zone.dragover {
            border-color: #10b981;
            background-color: #f0fdf4;
        }
        
        /* Loading States */
        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .pulse-dot {
            animation: pulse-dot 1.4s infinite ease-in-out;
        }
        .pulse-dot:nth-child(2) { animation-delay: 0.2s; }
        .pulse-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes pulse-dot {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
        
        /* Offline Game Styles */
        .offline-game {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 9999;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-family: 'Inter', sans-serif;
        }
        
        .game-container {
            text-align: center;
            max-width: 400px;
            width: 90%;
            padding: 20px;
        }
        
        .game-board {
            width: 300px;
            height: 300px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            margin: 20px auto;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255,255,255,0.2);
        }
        
        .snake-pixel, .food-pixel {
            position: absolute;
            width: 15px;
            height: 15px;
            border-radius: 2px;
        }
        
        .snake-pixel {
            background: #10b981;
            box-shadow: 0 0 5px rgba(16, 185, 129, 0.5);
        }
        
        .food-pixel {
            background: #ef4444;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.8);
            animation: food-glow 1s infinite alternate;
        }
        
        @keyframes food-glow {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }
        
        .game-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-width: 200px;
            margin: 20px auto;
        }
        
        .control-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .control-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }
        
        .control-btn:active {
            transform: scale(0.95);
        }
        
        .game-score {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .game-status {
            font-size: 16px;
            margin: 10px 0;
            opacity: 0.9;
        }
        
        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }
        
        .online { background: rgba(16, 185, 129, 0.9); }
        .offline { background: rgba(239, 68, 68, 0.9); }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .game-board {
                width: 280px;
                height: 280px;
            }
            
            .control-btn {
                padding: 12px;
                font-size: 16px;
            }
            
            .game-score {
                font-size: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .game-board {
                width: 250px;
                height: 250px;
            }
            
            .snake-pixel, .food-pixel {
                width: 12px;
                height: 12px;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="flex items-center justify-between px-6 py-4">
            <div class="flex items-center space-x-4">
                <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center p-1">
                    <img src="https://ik.imagekit.io/ys8l6suo53/Capturar-removebg-preview.png?updatedAt=" alt="Logo" class="w-full h-full object-contain" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <span class="text-green-600 font-bold text-xl hidden">üì¶</span>
                </div>
                <h1 class="text-2xl font-bold">StockControl Pro</h1>
            </div>
            <div class="flex items-center space-x-4">
                <div class="text-right">
                    <p class="text-sm opacity-90">√öltima sincroniza√ß√£o</p>
                    <p class="text-xs" id="lastSync">Hoje √†s 14:32</p>
                </div>
                <button onclick="syncBling()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition-colors">
                    üîÑ Sincronizar
                </button>
            </div>
        </div>
    </header>

    <!-- Connection Status -->
    <div id="connectionStatus" class="connection-status online">
        üü¢ Online
    </div>

    <!-- Offline Game -->
    <div id="offlineGame" class="offline-game">
        <div class="game-container">
            <h1 style="font-size: 28px; margin-bottom: 10px;">üêç Snake Game</h1>
            <p class="game-status">Sem conex√£o? Relaxe e jogue um pouco!</p>
            
            <div class="game-score">
                Pontua√ß√£o: <span id="gameScore">0</span>
            </div>
            
            <div id="gameBoard" class="game-board"></div>
            
            <div class="game-controls">
                <div></div>
                <button class="control-btn" onclick="changeDirection('up')">‚Üë</button>
                <div></div>
                <button class="control-btn" onclick="changeDirection('left')">‚Üê</button>
                <button class="control-btn" onclick="toggleGame()" id="playBtn">‚ñ∂Ô∏è</button>
                <button class="control-btn" onclick="changeDirection('right')">‚Üí</button>
                <div></div>
                <button class="control-btn" onclick="changeDirection('down')">‚Üì</button>
                <div></div>
            </div>
            
            <div class="game-status">
                <p>Use as setas ou toque nos bot√µes para jogar</p>
                <p style="font-size: 14px; opacity: 0.8;">Pressione ESC para voltar quando a conex√£o retornar</p>
            </div>
            
            <button onclick="hideOfflineGame()" class="control-btn" style="margin-top: 20px; background: rgba(255,255,255,0.3);">
                üîô Voltar ao Sistema
            </button>
        </div>
    </div>

    <div class="flex">
        <!-- Sidebar -->
        <aside class="w-64 bg-white shadow-lg h-screen sticky top-0">
            <nav class="p-4">
                <div class="space-y-2">
                    <button onclick="showSection('dashboard')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:text-white transition-all duration-200 flex items-center space-x-3">
                        <span>üìä</span><span>Dashboard</span>
                    </button>
                    <button onclick="showSection('estoque')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:text-white transition-all duration-200 flex items-center space-x-3">
                        <span>üì¶</span><span>Controle de Estoque</span>
                    </button>
                    <button onclick="showSection('conferencia')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:text-white transition-all duration-200 flex items-center space-x-3">
                        <span>‚úÖ</span><span>Confer√™ncia</span>
                    </button>
                    <button onclick="showSection('movimentacao')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:text-white transition-all duration-200 flex items-center space-x-3">
                        <span>üìã</span><span>Movimenta√ß√µes</span>
                    </button>
                    <button onclick="showSection('importacao')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:text-white transition-all duration-200 flex items-center space-x-3">
                        <span>üì•</span><span>Importa√ß√£o</span>
                    </button>
                    <button onclick="showSection('relatorios')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:text-white transition-all duration-200 flex items-center space-x-3">
                        <span>üìà</span><span>Relat√≥rios</span>
                    </button>
                    <button onclick="showSection('configuracoes')" class="sidebar-item w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:text-white transition-all duration-200 flex items-center space-x-3">
                        <span>‚öôÔ∏è</span><span>Configura√ß√µes</span>
                    </button>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6">
            <!-- Dashboard Section -->
            <div id="dashboard" class="section animate-fade-in">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Dashboard do Estoque</h2>
                    <p class="text-gray-600">Vis√£o geral do seu invent√°rio</p>
                </div>

                <!-- Loading State -->
                <div id="dashboardLoading" class="hidden">
                    <div class="text-center py-12">
                        <div class="inline-flex items-center space-x-2 text-blue-600 text-lg">
                            <div class="w-3 h-3 bg-blue-600 rounded-full pulse-dot"></div>
                            <div class="w-3 h-3 bg-blue-600 rounded-full pulse-dot"></div>
                            <div class="w-3 h-3 bg-blue-600 rounded-full pulse-dot"></div>
                            <span class="ml-3">Processando dados da planilha...</span>
                        </div>
                        <p class="text-gray-500 mt-2">Aguarde enquanto calculamos as informa√ß√µes do seu estoque</p>
                    </div>
                    
                    <!-- Loading Skeleton Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-xl shadow-sm">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="h-4 bg-gray-200 rounded loading-skeleton mb-2"></div>
                                    <div class="h-8 bg-gray-200 rounded loading-skeleton mb-2"></div>
                                    <div class="h-3 bg-gray-200 rounded loading-skeleton w-20"></div>
                                </div>
                                <div class="w-12 h-12 bg-gray-200 rounded-lg loading-skeleton"></div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="h-4 bg-gray-200 rounded loading-skeleton mb-2"></div>
                                    <div class="h-8 bg-gray-200 rounded loading-skeleton mb-2"></div>
                                    <div class="h-3 bg-gray-200 rounded loading-skeleton w-20"></div>
                                </div>
                                <div class="w-12 h-12 bg-gray-200 rounded-lg loading-skeleton"></div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="h-4 bg-gray-200 rounded loading-skeleton mb-2"></div>
                                    <div class="h-8 bg-gray-200 rounded loading-skeleton mb-2"></div>
                                    <div class="h-3 bg-gray-200 rounded loading-skeleton w-20"></div>
                                </div>
                                <div class="w-12 h-12 bg-gray-200 rounded-lg loading-skeleton"></div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="h-4 bg-gray-200 rounded loading-skeleton mb-2"></div>
                                    <div class="h-8 bg-gray-200 rounded loading-skeleton mb-2"></div>
                                    <div class="h-3 bg-gray-200 rounded loading-skeleton w-20"></div>
                                </div>
                                <div class="w-12 h-12 bg-gray-200 rounded-lg loading-skeleton"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- KPI Cards -->
                <div id="dashboardContent" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm card-hover transition-all duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">Total de Produtos</p>
                                <p class="text-2xl font-bold text-gray-800" id="totalProdutos">1.234</p>
                                <p class="text-green-500 text-sm">+23 este m√™s</p>
                            </div>
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <span class="text-blue-600 text-xl">üì¶</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm card-hover transition-all duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">Valor do Estoque</p>
                                <p class="text-2xl font-bold text-gray-800">R$ 89.450</p>
                                <p class="text-blue-500 text-sm">Custo m√©dio</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <span class="text-green-600 text-xl">üí∞</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm card-hover transition-all duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">Estoque Baixo</p>
                                <p class="text-2xl font-bold text-orange-600" id="estoqueBaixo">12</p>
                                <p class="text-orange-500 text-sm">Requer aten√ß√£o</p>
                            </div>
                            <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                <span class="text-orange-600 text-xl">‚ö†Ô∏è</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm card-hover transition-all duration-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-500 text-sm">Sem Estoque</p>
                                <p class="text-2xl font-bold text-red-600" id="semEstoque">5</p>
                                <p class="text-red-500 text-sm">Cr√≠tico</p>
                            </div>
                            <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                                <span class="text-red-600 text-xl">üö®</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Alertas -->
                <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
                    <h3 class="text-lg font-semibold mb-4">Alertas do Sistema</h3>
                    <div id="alertas" class="space-y-3">
                        <!-- Alertas ser√£o inseridos aqui -->
                    </div>
                </div>

                <!-- Gr√°ficos -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-sm">
                        <h3 class="text-lg font-semibold mb-4">Movimenta√ß√£o dos √öltimos 7 Dias</h3>
                        <canvas id="movimentacaoChart" width="400" height="200"></canvas>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm">
                        <h3 class="text-lg font-semibold mb-4">Produtos por Categoria</h3>
                        <canvas id="categoriaChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>

            <!-- Estoque Section -->
            <div id="estoque" class="section hidden animate-fade-in">
                <div class="mb-6 flex justify-between items-center">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Controle de Estoque</h2>
                        <p class="text-gray-600">Gerencie seu invent√°rio completo</p>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="openModal('novoProduto')" class="gradient-bg text-white px-6 py-3 rounded-lg hover:opacity-90 transition-opacity">
                            + Novo Produto
                        </button>
                        <button onclick="openModal('ajusteEstoque')" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                            üìù Ajuste de Estoque
                        </button>
                    </div>
                </div>

                <!-- Filtros -->
                <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <input type="text" id="searchProduto" placeholder="Buscar por nome ou SKU..." class="px-4 py-2 border rounded-lg">
                        <select id="filterCategoria" class="px-4 py-2 border rounded-lg">
                            <option value="">Todas as categorias</option>
                            <option value="Eletr√¥nicos">Eletr√¥nicos</option>
                            <option value="Roupas">Roupas</option>
                            <option value="Casa">Casa</option>
                            <option value="Cal√ßados">Cal√ßados</option>
                        </select>
                        <select id="filterStatus" class="px-4 py-2 border rounded-lg">
                            <option value="">Todos os status</option>
                            <option value="ok">Estoque OK</option>
                            <option value="baixo">Estoque Baixo</option>
                            <option value="critico">Sem Estoque</option>
                        </select>
                        <button onclick="aplicarFiltros()" class="gradient-bg text-white px-4 py-2 rounded-lg hover:opacity-90">
                            üîç Filtrar
                        </button>
                    </div>
                </div>

                <!-- Tabela de Produtos -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Produto</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">SKU</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Categoria</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estoque Atual</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estoque M√≠n.</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Custo Unit.</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="estoqueTable" class="divide-y divide-gray-200">
                                <!-- Produtos ser√£o inseridos aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Confer√™ncia Section -->
            <div id="conferencia" class="section hidden animate-fade-in">
                <div class="mb-6 flex justify-between items-center">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Confer√™ncia de Estoque</h2>
                        <p class="text-gray-600">Realize invent√°rios e confer√™ncias</p>
                    </div>
                    <button onclick="iniciarConferencia()" class="gradient-bg text-white px-6 py-3 rounded-lg hover:opacity-90 transition-opacity">
                        üîç Iniciar Nova Confer√™ncia
                    </button>
                </div>

                <!-- Confer√™ncia Ativa -->
                <div id="conferenciaAtiva" class="bg-white rounded-xl shadow-sm p-6 mb-6 hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Confer√™ncia em Andamento</h3>
                        <div class="flex space-x-2">
                            <button onclick="salvarConferencia()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                                üíæ Salvar
                            </button>
                            <button onclick="finalizarConferencia()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                ‚úÖ Finalizar
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-sm text-blue-600">Produtos Conferidos</p>
                            <p class="text-2xl font-bold text-blue-700" id="produtosConferidos">0</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <p class="text-sm text-green-600">Corretos</p>
                            <p class="text-2xl font-bold text-green-700" id="produtosCorretos">0</p>
                        </div>
                        <div class="bg-red-50 p-4 rounded-lg">
                            <p class="text-sm text-red-600">Diverg√™ncias</p>
                            <p class="text-2xl font-bold text-red-700" id="produtosDivergentes">0</p>
                        </div>
                    </div>

                    <div class="border-t pt-4">
                        <div class="flex space-x-4 mb-4">
                            <input type="text" id="skuConferencia" placeholder="Digite ou escaneie o SKU..." class="flex-1 px-4 py-2 border rounded-lg">
                            <input type="number" id="quantidadeConferencia" placeholder="Quantidade" class="w-32 px-4 py-2 border rounded-lg">
                            <button onclick="adicionarItemConferencia()" class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90">
                                ‚ûï Adicionar
                            </button>
                        </div>
                        
                        <div id="itensConferencia" class="space-y-2">
                            <!-- Itens da confer√™ncia ser√£o inseridos aqui -->
                        </div>
                    </div>
                </div>

                <!-- Hist√≥rico de Confer√™ncias -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="p-6 border-b">
                        <h3 class="text-lg font-semibold">Hist√≥rico de Confer√™ncias</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Respons√°vel</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Produtos</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Diverg√™ncias</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="conferenciaTable" class="divide-y divide-gray-200">
                                <!-- Confer√™ncias ser√£o inseridas aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Movimenta√ß√£o Section -->
            <div id="movimentacao" class="section hidden animate-fade-in">
                <div class="mb-6 flex justify-between items-center">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-2">Movimenta√ß√µes de Estoque</h2>
                        <p class="text-gray-600">Hist√≥rico de entradas e sa√≠das</p>
                    </div>
                    <button onclick="openModal('novaMovimentacao')" class="gradient-bg text-white px-6 py-3 rounded-lg hover:opacity-90 transition-opacity">
                        üìù Nova Movimenta√ß√£o
                    </button>
                </div>

                <!-- Filtros de Movimenta√ß√£o -->
                <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                        <input type="date" id="dataInicio" class="px-4 py-2 border rounded-lg">
                        <input type="date" id="dataFim" class="px-4 py-2 border rounded-lg">
                        <select id="tipoMovimentacao" class="px-4 py-2 border rounded-lg">
                            <option value="">Todos os tipos</option>
                            <option value="entrada">Entrada</option>
                            <option value="saida">Sa√≠da</option>
                            <option value="ajuste">Ajuste</option>
                            <option value="transferencia">Transfer√™ncia</option>
                        </select>
                        <input type="text" id="searchMovimentacao" placeholder="Buscar produto..." class="px-4 py-2 border rounded-lg">
                        <button onclick="filtrarMovimentacoes()" class="gradient-bg text-white px-4 py-2 rounded-lg hover:opacity-90">
                            üîç Filtrar
                        </button>
                    </div>
                </div>

                <!-- Tabela de Movimenta√ß√µes -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data/Hora</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Produto</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tipo</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Quantidade</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estoque Anterior</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estoque Atual</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Respons√°vel</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Observa√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="movimentacaoTable" class="divide-y divide-gray-200">
                                <!-- Movimenta√ß√µes ser√£o inseridas aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Importa√ß√£o Section -->
            <div id="importacao" class="section hidden animate-fade-in">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Importa√ß√£o de Dados</h2>
                    <p class="text-gray-600">Importe dados de planilhas ou sincronize com o Bling</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Importa√ß√£o de Planilha -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <span class="mr-2">üìä</span>
                            Importar Planilha Excel/CSV
                        </h3>
                        
                        <div class="file-drop-zone p-8 rounded-lg text-center mb-4" id="dropZone">
                            <div class="mb-4">
                                <span class="text-4xl">üìÅ</span>
                            </div>
                            <p class="text-gray-600 mb-2">Arraste e solte sua planilha aqui</p>
                            <p class="text-sm text-gray-500 mb-4">ou</p>
                            <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" class="hidden">
                            <button onclick="document.getElementById('fileInput').click()" class="gradient-bg text-white px-6 py-2 rounded-lg hover:opacity-90">
                                Selecionar Arquivo
                            </button>
                        </div>
                        
                        <div class="text-sm text-gray-500 mb-4">
                            <p><strong>Formatos aceitos:</strong> .xlsx, .xls, .csv</p>
                            <p><strong>Colunas obrigat√≥rias:</strong> C√≥digo/SKU, Descri√ß√£o/Nome, Estoque/Quantidade</p>
                            <p><strong>Limite m√°ximo:</strong> 10.000 produtos por planilha</p>
                            <p class="text-blue-600 mt-2">üí° Os produtos ser√£o automaticamente adicionados √† lista para confer√™ncia</p>
                        </div>
                        
                        <button onclick="downloadTemplate()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 mb-4">
                            üì• Baixar Modelo de Planilha
                        </button>
                        
                        <div id="importProgress" class="hidden">
                            <div class="bg-gray-200 rounded-full h-2 mb-2">
                                <div class="bg-green-600 h-2 rounded-full transition-all duration-300" style="width: 0%" id="progressBar"></div>
                            </div>
                            <p class="text-sm text-gray-600" id="progressText">Processando...</p>
                        </div>
                    </div>

                    <!-- Integra√ß√£o Bling -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <span class="mr-2">üîó</span>
                            Integra√ß√£o com Bling
                        </h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">API Key do Bling</label>
                                <input type="password" id="blingApiKey" placeholder="Insira sua chave da API" class="w-full px-4 py-2 border rounded-lg">
                            </div>
                            
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div>
                                    <p class="font-medium">Status da Conex√£o</p>
                                    <p class="text-sm text-gray-600" id="blingStatus">N√£o conectado</p>
                                </div>
                                <div class="w-3 h-3 bg-red-500 rounded-full" id="blingIndicator"></div>
                            </div>
                            
                            <button onclick="testarConexaoBling()" class="w-full gradient-bg text-white py-2 rounded-lg hover:opacity-90 mb-2">
                                üîç Testar Conex√£o
                            </button>
                            
                            <button onclick="sincronizarBling()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 mb-2" disabled id="syncBlingBtn">
                                üîÑ Sincronizar Produtos
                            </button>
                            
                            <div class="text-sm text-gray-500">
                                <p><strong>Funcionalidades:</strong></p>
                                <ul class="list-disc list-inside mt-1 space-y-1">
                                    <li>Importar produtos do Bling</li>
                                    <li>Sincronizar estoque automaticamente</li>
                                    <li>Atualizar pre√ßos e informa√ß√µes</li>
                                    <li>Exportar movimenta√ß√µes</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hist√≥rico de Importa√ß√µes -->
                <div class="bg-white rounded-xl shadow-sm mt-6">
                    <div class="p-6 border-b">
                        <h3 class="text-lg font-semibold">Hist√≥rico de Importa√ß√µes</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tipo</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Arquivo/Origem</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Registros</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="importacaoTable" class="divide-y divide-gray-200">
                                <!-- Importa√ß√µes ser√£o inseridas aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Relat√≥rios Section -->
            <div id="relatorios" class="section hidden animate-fade-in">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Relat√≥rios de Estoque</h2>
                    <p class="text-gray-600">An√°lises e relat√≥rios detalhados</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-sm card-hover cursor-pointer" onclick="gerarRelatorio('posicao')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <span class="text-blue-600 text-xl">üìä</span>
                            </div>
                            <div>
                                <h3 class="font-semibold">Posi√ß√£o de Estoque</h3>
                                <p class="text-sm text-gray-500">Situa√ß√£o atual do invent√°rio</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm card-hover cursor-pointer" onclick="gerarRelatorio('movimentacao')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <span class="text-green-600 text-xl">üìã</span>
                            </div>
                            <div>
                                <h3 class="font-semibold">Movimenta√ß√µes</h3>
                                <p class="text-sm text-gray-500">Entradas e sa√≠das detalhadas</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm card-hover cursor-pointer" onclick="gerarRelatorio('valorizado')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                <span class="text-purple-600 text-xl">üí∞</span>
                            </div>
                            <div>
                                <h3 class="font-semibold">Estoque Valorizado</h3>
                                <p class="text-sm text-gray-500">Valor total por produto</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm card-hover cursor-pointer" onclick="gerarRelatorio('abc')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                                <span class="text-yellow-600 text-xl">üèÜ</span>
                            </div>
                            <div>
                                <h3 class="font-semibold">Curva ABC</h3>
                                <p class="text-sm text-gray-500">Classifica√ß√£o por import√¢ncia</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm card-hover cursor-pointer" onclick="gerarRelatorio('giro')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                                <span class="text-red-600 text-xl">üîÑ</span>
                            </div>
                            <div>
                                <h3 class="font-semibold">Giro de Estoque</h3>
                                <p class="text-sm text-gray-500">Velocidade de rota√ß√£o</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm card-hover cursor-pointer" onclick="gerarRelatorio('conferencia')">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center">
                                <span class="text-indigo-600 text-xl">‚úÖ</span>
                            </div>
                            <div>
                                <h3 class="font-semibold">Confer√™ncias</h3>
                                <p class="text-sm text-gray-500">Hist√≥rico de invent√°rios</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resultado do Relat√≥rio -->
                <div id="relatorioResult" class="bg-white rounded-xl shadow-sm p-6 hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold" id="relatorioTitle">Relat√≥rio</h3>
                        <div class="flex space-x-2">
                            <button onclick="exportarRelatorio('excel')" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                                üìä Excel
                            </button>
                            <button onclick="exportarRelatorio('pdf')" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                                üìÑ PDF
                            </button>
                        </div>
                    </div>
                    <div id="relatorioContent"></div>
                </div>
            </div>

            <!-- Configura√ß√µes Section -->
            <div id="configuracoes" class="section hidden animate-fade-in">
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Configura√ß√µes do Sistema</h2>
                    <p class="text-gray-600">Configure alertas, integra√ß√µes e prefer√™ncias</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Alertas de Estoque -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Alertas de Estoque</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Estoque M√≠nimo Global</label>
                                <input type="number" id="estoqueMinimo" value="10" class="w-full px-4 py-2 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Dias para Alerta de Vencimento</label>
                                <input type="number" id="diasVencimento" value="30" class="w-full px-4 py-2 border rounded-lg">
                            </div>
                            <div class="flex items-center space-x-2">
                                <input type="checkbox" id="alertaEmail" checked class="rounded">
                                <label for="alertaEmail" class="text-sm text-gray-700">Enviar alertas por email</label>
                            </div>
                            <div class="flex items-center space-x-2">
                                <input type="checkbox" id="alertaWhatsapp" class="rounded">
                                <label for="alertaWhatsapp" class="text-sm text-gray-700">Enviar alertas por WhatsApp</label>
                            </div>
                        </div>
                    </div>

                    <!-- Configura√ß√µes de Backup -->
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold mb-4">Backup e Seguran√ßa</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Backup Autom√°tico</label>
                                <select class="w-full px-4 py-2 border rounded-lg">
                                    <option value="diario">Di√°rio</option>
                                    <option value="semanal">Semanal</option>
                                    <option value="mensal">Mensal</option>
                                    <option value="desabilitado">Desabilitado</option>
                                </select>
                            </div>
                            <button onclick="fazerBackup()" class="w-full gradient-bg text-white py-2 rounded-lg hover:opacity-90">
                                üíæ Fazer Backup Agora
                            </button>
                            <button onclick="restaurarBackup()" class="w-full bg-gray-600 text-white py-2 rounded-lg hover:bg-gray-700">
                                üì• Restaurar Backup
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Reset do Sistema -->
                <div class="bg-white rounded-xl shadow-sm p-6 mt-6">
                    <h3 class="text-lg font-semibold mb-4 text-red-600">‚ö†Ô∏è Zona de Perigo</h3>
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                        <p class="text-sm text-red-700 mb-2">
                            <strong>Aten√ß√£o:</strong> Esta a√ß√£o ir√° apagar permanentemente todos os dados do sistema:
                        </p>
                        <ul class="text-sm text-red-600 list-disc list-inside space-y-1">
                            <li>Todos os produtos cadastrados</li>
                            <li>Hist√≥rico de movimenta√ß√µes</li>
                            <li>Confer√™ncias realizadas</li>
                            <li>Importa√ß√µes anteriores</li>
                            <li>Configura√ß√µes personalizadas</li>
                        </ul>
                    </div>
                    <button onclick="confirmarReset()" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition-colors">
                        üóëÔ∏è Resetar Todo o Sistema
                    </button>
                </div>

                <div class="mt-6">
                    <button onclick="salvarConfiguracoes()" class="gradient-bg text-white px-8 py-3 rounded-lg hover:opacity-90">
                        üíæ Salvar Configura√ß√µes
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Overlay -->
    <div id="modalOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50" onclick="closeModal()">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6" onclick="event.stopPropagation()">
                <div id="modalContent"></div>
            </div>
        </div>
    </div>

    <script>
        // Dados simulados
        let produtos = [
            {id: 1, nome: 'Smartphone Galaxy S23', sku: 'GAL-S23-001', categoria: 'Eletr√¥nicos', estoque: 25, estoqueMin: 10, custo: 1200.00, status: 'ok'},
            {id: 2, nome: 'Camiseta Polo Azul', sku: 'CAM-POL-002', categoria: 'Roupas', estoque: 8, estoqueMin: 15, custo: 45.90, status: 'baixo'},
            {id: 3, nome: 'Fone Bluetooth JBL', sku: 'FON-JBL-003', categoria: 'Eletr√¥nicos', estoque: 0, estoqueMin: 5, custo: 89.90, status: 'critico'},
            {id: 4, nome: 'T√™nis Nike Air Max', sku: 'TEN-NIK-004', categoria: 'Cal√ßados', estoque: 45, estoqueMin: 20, custo: 299.90, status: 'ok'},
            {id: 5, nome: 'Mesa de Escrit√≥rio', sku: 'MES-ESC-005', categoria: 'Casa', estoque: 12, estoqueMin: 8, custo: 450.00, status: 'ok'}
        ];

        let movimentacoes = [
            {id: 1, data: '2024-01-15 14:30', produto: 'Smartphone Galaxy S23', tipo: 'entrada', quantidade: 50, estoqueAnterior: 25, estoqueAtual: 75, responsavel: 'Jo√£o Silva', observacoes: 'Compra fornecedor ABC'},
            {id: 2, data: '2024-01-15 10:15', produto: 'Camiseta Polo Azul', tipo: 'saida', quantidade: 5, estoqueAnterior: 13, estoqueAtual: 8, responsavel: 'Maria Santos', observacoes: 'Venda loja f√≠sica'},
            {id: 3, data: '2024-01-14 16:45', produto: 'Fone Bluetooth JBL', tipo: 'saida', quantidade: 3, estoqueAnterior: 3, estoqueAtual: 0, responsavel: 'Pedro Costa', observacoes: 'Venda online'}
        ];

        let conferencias = [
            {id: 1, data: '2024-01-10', responsavel: 'Ana Oliveira', produtos: 156, divergencias: 3, status: 'Finalizada'},
            {id: 2, data: '2024-01-05', responsavel: 'Carlos Lima', produtos: 142, divergencias: 0, status: 'Finalizada'},
            {id: 3, data: '2023-12-28', responsavel: 'Jo√£o Silva', produtos: 134, divergencias: 7, status: 'Finalizada'}
        ];

        let importacoes = [
            {id: 1, data: '2024-01-15 09:30', tipo: 'Planilha Excel', origem: 'produtos_janeiro.xlsx', registros: 45, status: 'Conclu√≠da'},
            {id: 2, data: '2024-01-14 15:20', tipo: 'API Bling', origem: 'Sincroniza√ß√£o autom√°tica', registros: 123, status: 'Conclu√≠da'},
            {id: 3, data: '2024-01-13 11:45', tipo: 'CSV', origem: 'estoque_atualizado.csv', registros: 67, status: 'Erro'}
        ];

        let conferenciaAtual = {
            ativa: false,
            itens: [],
            produtosConferidos: 0,
            produtosCorretos: 0,
            produtosDivergentes: 0
        };

        // Navega√ß√£o entre se√ß√µes
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionName).classList.remove('hidden');
            
            // Carregar dados espec√≠ficos da se√ß√£o
            if (sectionName === 'dashboard') loadDashboard();
            if (sectionName === 'estoque') loadEstoque();
            if (sectionName === 'conferencia') loadConferencia();
            if (sectionName === 'movimentacao') loadMovimentacao();
            if (sectionName === 'importacao') loadImportacao();
        }

        // Dashboard
        function loadDashboard() {
            // Calcular KPIs baseados nos dados reais da planilha
            const totalProdutos = produtos.length;
            const produtosBaixo = produtos.filter(p => p.status === 'baixo').length;
            const produtosCriticos = produtos.filter(p => p.status === 'critico').length;
            const valorTotalEstoque = produtos.reduce((total, p) => total + (p.estoque * p.custo), 0);
            
            // Calcular crescimento mensal (simulado baseado nos dados)
            const crescimentoMensal = Math.floor(totalProdutos * 0.15); // 15% dos produtos como crescimento
            
            // Atualizar KPIs na interface
            document.getElementById('totalProdutos').textContent = totalProdutos.toLocaleString('pt-BR');
            document.getElementById('estoqueBaixo').textContent = produtosBaixo;
            document.getElementById('semEstoque').textContent = produtosCriticos;
            
            // Atualizar valor do estoque
            const valorEstoqueElement = document.querySelector('.text-2xl.font-bold.text-gray-800');
            if (valorEstoqueElement && valorEstoqueElement.textContent.includes('R$')) {
                valorEstoqueElement.textContent = `R$ ${valorTotalEstoque.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
            }
            
            // Atualizar crescimento mensal
            const crescimentoElement = document.querySelector('.text-green-500.text-sm');
            if (crescimentoElement && crescimentoElement.textContent.includes('este m√™s')) {
                crescimentoElement.textContent = `+${crescimentoMensal} este m√™s`;
            }

            // Carregar alertas
            loadAlertas();
            
            // Carregar gr√°ficos com dados reais
            loadCharts();
        }

        function loadAlertas() {
            const alertasContainer = document.getElementById('alertas');
            const alertas = [];

            // Produtos sem estoque
            produtos.filter(p => p.status === 'critico').forEach(produto => {
                alertas.push({
                    tipo: 'critico',
                    mensagem: `${produto.nome} est√° sem estoque!`,
                    acao: 'Reabastecer urgente'
                });
            });

            // Produtos com estoque baixo
            produtos.filter(p => p.status === 'baixo').forEach(produto => {
                alertas.push({
                    tipo: 'aviso',
                    mensagem: `${produto.nome} com estoque baixo (${produto.estoque} unidades)`,
                    acao: 'Considerar reposi√ß√£o'
                });
            });

            alertasContainer.innerHTML = alertas.map(alerta => `
                <div class="flex items-center justify-between p-4 border-l-4 ${alerta.tipo === 'critico' ? 'border-red-500 bg-red-50' : 'border-yellow-500 bg-yellow-50'} rounded-r-lg">
                    <div class="flex items-center space-x-3">
                        <span class="text-2xl">${alerta.tipo === 'critico' ? 'üö®' : '‚ö†Ô∏è'}</span>
                        <div>
                            <p class="font-medium ${alerta.tipo === 'critico' ? 'text-red-800' : 'text-yellow-800'}">${alerta.mensagem}</p>
                            <p class="text-sm ${alerta.tipo === 'critico' ? 'text-red-600' : 'text-yellow-600'}">${alerta.acao}</p>
                        </div>
                    </div>
                    <button class="text-gray-400 hover:text-gray-600">‚úï</button>
                </div>
            `).join('');
        }

        // Estoque
        function loadEstoque() {
            const tbody = document.getElementById('estoqueTable');
            tbody.innerHTML = produtos.map(produto => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${produto.nome}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${produto.sku}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${produto.categoria}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${produto.status === 'critico' ? 'text-red-600 font-bold' : produto.status === 'baixo' ? 'text-yellow-600 font-medium' : 'text-gray-900'}">${produto.estoque}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${produto.estoqueMin}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">R$ ${produto.custo.toFixed(2)}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs rounded-full status-${produto.status}">${getStatusText(produto.status)}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <button onclick="editarProduto(${produto.id})" class="text-blue-600 hover:text-blue-900 mr-2">Editar</button>
                        <button onclick="ajustarEstoque(${produto.id})" class="text-green-600 hover:text-green-900 mr-2">Ajustar</button>
                        <button onclick="excluirProduto(${produto.id})" class="text-red-600 hover:text-red-900">Excluir</button>
                    </td>
                </tr>
            `).join('');
        }

        function getStatusText(status) {
            switch(status) {
                case 'ok': return 'OK';
                case 'baixo': return 'Baixo';
                case 'critico': return 'Cr√≠tico';
                default: return 'N/A';
            }
        }

        // Confer√™ncia
        function loadConferencia() {
            const tbody = document.getElementById('conferenciaTable');
            tbody.innerHTML = conferencias.map(conf => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${conf.data}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${conf.responsavel}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${conf.produtos}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${conf.divergencias > 0 ? 'text-red-600' : 'text-green-600'}">${conf.divergencias}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs rounded-full ${conf.status === 'Finalizada' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">${conf.status}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <button onclick="verConferencia(${conf.id})" class="text-blue-600 hover:text-blue-900 mr-2">Ver</button>
                        <button onclick="exportarConferencia(${conf.id})" class="text-green-600 hover:text-green-900">Exportar</button>
                    </td>
                </tr>
            `).join('');
        }

        function iniciarConferencia() {
            conferenciaAtual.ativa = true;
            conferenciaAtual.itens = [];
            conferenciaAtual.produtosConferidos = 0;
            conferenciaAtual.produtosCorretos = 0;
            conferenciaAtual.produtosDivergentes = 0;
            
            document.getElementById('conferenciaAtiva').classList.remove('hidden');
            atualizarContadoresConferencia();
            showNotification('Confer√™ncia iniciada! Comece escaneando ou digitando os SKUs.', 'success');
        }

        function iniciarConferenciaComProdutos(produtosParaConferencia) {
            conferenciaAtual.ativa = true;
            conferenciaAtual.itens = [];
            conferenciaAtual.produtosConferidos = 0;
            conferenciaAtual.produtosCorretos = 0;
            conferenciaAtual.produtosDivergentes = 0;
            conferenciaAtual.produtosImportados = produtosParaConferencia;
            
            // Ir automaticamente para a se√ß√£o de confer√™ncia
            showSection('conferencia');
            
            document.getElementById('conferenciaAtiva').classList.remove('hidden');
            
            // Mostrar lista de produtos para conferir
            mostrarListaProdutosConferencia(produtosParaConferencia);
            
            atualizarContadoresConferencia();
            showNotification(`Confer√™ncia iniciada automaticamente com ${produtosParaConferencia.length} produtos da planilha!`, 'success');
        }

        function mostrarListaProdutosConferencia(produtosParaConferencia) {
            const container = document.getElementById('itensConferencia');
            
            const listaProdutos = `
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                    <h4 class="font-semibold text-blue-800 mb-3">üìã Produtos da Planilha para Conferir:</h4>
                    <div class="space-y-2 max-h-60 overflow-y-auto">
                        ${produtosParaConferencia.map(produto => `
                            <div class="flex items-center justify-between p-2 bg-white rounded border">
                                <div>
                                    <p class="font-medium text-sm">${produto.nome}</p>
                                    <p class="text-xs text-gray-600">SKU: ${produto.sku}</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-sm font-medium text-blue-600">Esperado: ${produto.quantidadeEsperada}</p>
                                    <button onclick="conferirProdutoRapido('${produto.sku}', ${produto.quantidadeEsperada})" 
                                            class="text-xs bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600">
                                        ‚úÖ Conferir
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="mt-3 text-xs text-blue-700">
                        üí° <strong>Dica:</strong> Use os bot√µes "Conferir" para confirmar rapidamente as quantidades da planilha, 
                        ou digite manualmente no campo abaixo para ajustar.
                    </div>
                </div>
            `;
            
            container.innerHTML = listaProdutos;
        }

        function conferirProdutoRapido(sku, quantidadeEsperada) {
            const produto = produtos.find(p => p.sku === sku);
            if (!produto) {
                showNotification('Produto n√£o encontrado!', 'error');
                return;
            }
            
            const item = {
                sku: sku,
                nome: produto.nome,
                estoqueAtual: produto.estoque,
                quantidadeConferida: quantidadeEsperada,
                divergencia: quantidadeEsperada !== produto.estoque
            };
            
            // Verificar se j√° foi conferido
            const jaConferido = conferenciaAtual.itens.find(i => i.sku === sku);
            if (jaConferido) {
                showNotification('Produto j√° foi conferido!', 'warning');
                return;
            }
            
            conferenciaAtual.itens.push(item);
            conferenciaAtual.produtosConferidos++;
            
            if (item.divergencia) {
                conferenciaAtual.produtosDivergentes++;
            } else {
                conferenciaAtual.produtosCorretos++;
            }
            
            atualizarContadoresConferencia();
            atualizarListaConferencia();
            
            showNotification(`${produto.nome} conferido com ${quantidadeEsperada} unidades!`, 'success');
        }

        function adicionarItemConferencia() {
            const sku = document.getElementById('skuConferencia').value.trim();
            const quantidade = parseInt(document.getElementById('quantidadeConferencia').value);
            
            if (!sku || !quantidade) {
                showNotification('Preencha o SKU e a quantidade!', 'error');
                return;
            }
            
            const produto = produtos.find(p => p.sku === sku);
            if (!produto) {
                showNotification('Produto n√£o encontrado!', 'error');
                return;
            }
            
            const item = {
                sku: sku,
                nome: produto.nome,
                estoqueAtual: produto.estoque,
                quantidadeConferida: quantidade,
                divergencia: quantidade !== produto.estoque
            };
            
            conferenciaAtual.itens.push(item);
            conferenciaAtual.produtosConferidos++;
            
            if (item.divergencia) {
                conferenciaAtual.produtosDivergentes++;
            } else {
                conferenciaAtual.produtosCorretos++;
            }
            
            // Limpar campos
            document.getElementById('skuConferencia').value = '';
            document.getElementById('quantidadeConferencia').value = '';
            
            atualizarContadoresConferencia();
            atualizarListaConferencia();
            
            showNotification(`Produto ${produto.nome} adicionado √† confer√™ncia!`, 'success');
        }

        function atualizarContadoresConferencia() {
            document.getElementById('produtosConferidos').textContent = conferenciaAtual.produtosConferidos;
            document.getElementById('produtosCorretos').textContent = conferenciaAtual.produtosCorretos;
            document.getElementById('produtosDivergentes').textContent = conferenciaAtual.produtosDivergentes;
        }

        function atualizarListaConferencia() {
            const container = document.getElementById('itensConferencia');
            
            let conteudo = '';
            
            // Mostrar lista de produtos importados se existir
            if (conferenciaAtual.produtosImportados && conferenciaAtual.produtosImportados.length > 0) {
                const produtosRestantes = conferenciaAtual.produtosImportados.filter(p => 
                    !conferenciaAtual.itens.find(i => i.sku === p.sku)
                );
                
                if (produtosRestantes.length > 0) {
                    conteudo += `
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                            <h4 class="font-semibold text-blue-800 mb-3">üìã Produtos da Planilha Restantes (${produtosRestantes.length}):</h4>
                            <div class="space-y-2 max-h-40 overflow-y-auto">
                                ${produtosRestantes.map(produto => `
                                    <div class="flex items-center justify-between p-2 bg-white rounded border">
                                        <div>
                                            <p class="font-medium text-sm">${produto.nome}</p>
                                            <p class="text-xs text-gray-600">SKU: ${produto.sku}</p>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-sm font-medium text-blue-600">Esperado: ${produto.quantidadeEsperada}</p>
                                            <button onclick="conferirProdutoRapido('${produto.sku}', ${produto.quantidadeEsperada})" 
                                                    class="text-xs bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600">
                                                ‚úÖ Conferir
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
            }
            
            // Mostrar produtos j√° conferidos
            if (conferenciaAtual.itens.length > 0) {
                conteudo += `
                    <div class="mb-4">
                        <h4 class="font-semibold text-gray-800 mb-3">‚úÖ Produtos Conferidos (${conferenciaAtual.itens.length}):</h4>
                        <div class="space-y-2">
                            ${conferenciaAtual.itens.map(item => `
                                <div class="flex items-center justify-between p-3 border rounded-lg ${item.divergencia ? 'border-red-200 bg-red-50' : 'border-green-200 bg-green-50'}">
                                    <div class="flex-1">
                                        <p class="font-medium">${item.nome}</p>
                                        <p class="text-sm text-gray-600">SKU: ${item.sku}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-sm">Sistema: ${item.estoqueAtual} | Conferido: ${item.quantidadeConferida}</p>
                                        ${item.divergencia ? '<p class="text-xs text-red-600">‚ö†Ô∏è Diverg√™ncia</p>' : '<p class="text-xs text-green-600">‚úÖ OK</p>'}
                                    </div>
                                    <button onclick="removerItemConferencia('${item.sku}')" class="ml-2 text-red-500 hover:text-red-700 text-xs">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = conteudo;
        }

        function removerItemConferencia(sku) {
            const index = conferenciaAtual.itens.findIndex(item => item.sku === sku);
            if (index !== -1) {
                const item = conferenciaAtual.itens[index];
                conferenciaAtual.itens.splice(index, 1);
                conferenciaAtual.produtosConferidos--;
                
                if (item.divergencia) {
                    conferenciaAtual.produtosDivergentes--;
                } else {
                    conferenciaAtual.produtosCorretos--;
                }
                
                atualizarContadoresConferencia();
                atualizarListaConferencia();
                showNotification('Item removido da confer√™ncia!', 'info');
            }
        }

        function finalizarConferencia() {
            if (conferenciaAtual.itens.length === 0) {
                showNotification('Adicione pelo menos um item √† confer√™ncia!', 'error');
                return;
            }
            
            const novaConferencia = {
                id: conferencias.length + 1,
                data: new Date().toISOString().split('T')[0],
                responsavel: 'Usu√°rio Atual',
                produtos: conferenciaAtual.produtosConferidos,
                divergencias: conferenciaAtual.produtosDivergentes,
                status: 'Finalizada'
            };
            
            conferencias.unshift(novaConferencia);
            
            // Aplicar ajustes se houver diverg√™ncias
            if (conferenciaAtual.produtosDivergentes > 0) {
                if (confirm(`Foram encontradas ${conferenciaAtual.produtosDivergentes} diverg√™ncias. Deseja aplicar os ajustes automaticamente?`)) {
                    aplicarAjustesConferencia();
                }
            }
            
            // Resetar confer√™ncia
            conferenciaAtual.ativa = false;
            document.getElementById('conferenciaAtiva').classList.add('hidden');
            
            loadConferencia();
            showNotification('Confer√™ncia finalizada com sucesso!', 'success');
        }

        function aplicarAjustesConferencia() {
            conferenciaAtual.itens.forEach(item => {
                if (item.divergencia) {
                    const produto = produtos.find(p => p.sku === item.sku);
                    if (produto) {
                        const movimentacao = {
                            id: movimentacoes.length + 1,
                            data: new Date().toISOString().replace('T', ' ').substring(0, 16),
                            produto: produto.nome,
                            tipo: 'ajuste',
                            quantidade: item.quantidadeConferida - produto.estoque,
                            estoqueAnterior: produto.estoque,
                            estoqueAtual: item.quantidadeConferida,
                            responsavel: 'Sistema - Confer√™ncia',
                            observacoes: 'Ajuste autom√°tico por confer√™ncia'
                        };
                        
                        produto.estoque = item.quantidadeConferida;
                        produto.status = getStatusProduto(produto);
                        movimentacoes.unshift(movimentacao);
                    }
                }
            });
            
            showNotification('Ajustes aplicados com sucesso!', 'success');
        }

        // Movimenta√ß√£o
        function loadMovimentacao() {
            const tbody = document.getElementById('movimentacaoTable');
            tbody.innerHTML = movimentacoes.map(mov => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${mov.data}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${mov.produto}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs rounded-full ${getTipoMovimentacaoClass(mov.tipo)}">${getTipoMovimentacaoText(mov.tipo)}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${mov.tipo === 'entrada' ? 'text-green-600' : 'text-red-600'}">${mov.tipo === 'entrada' ? '+' : ''}${mov.quantidade}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${mov.estoqueAnterior}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${mov.estoqueAtual}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${mov.responsavel}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${mov.observacoes}</td>
                </tr>
            `).join('');
        }

        function getTipoMovimentacaoClass(tipo) {
            switch(tipo) {
                case 'entrada': return 'bg-green-100 text-green-800';
                case 'saida': return 'bg-red-100 text-red-800';
                case 'ajuste': return 'bg-blue-100 text-blue-800';
                case 'transferencia': return 'bg-purple-100 text-purple-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getTipoMovimentacaoText(tipo) {
            switch(tipo) {
                case 'entrada': return 'Entrada';
                case 'saida': return 'Sa√≠da';
                case 'ajuste': return 'Ajuste';
                case 'transferencia': return 'Transfer√™ncia';
                default: return tipo;
            }
        }

        // Importa√ß√£o
        function loadImportacao() {
            const tbody = document.getElementById('importacaoTable');
            tbody.innerHTML = importacoes.map(imp => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${imp.data}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${imp.tipo}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${imp.origem}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${imp.registros}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs rounded-full ${imp.status === 'Conclu√≠da' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">${imp.status}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <button onclick="verDetalhesImportacao(${imp.id})" class="text-blue-600 hover:text-blue-900">Ver Detalhes</button>
                    </td>
                </tr>
            `).join('');

            // Configurar drag and drop
            setupFileDropZone();
        }

        function setupFileDropZone() {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');

            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });

            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    processarArquivo(files[0]);
                }
            });

            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    processarArquivo(e.target.files[0]);
                }
            });
        }

        function processarArquivo(file) {
            const allowedTypes = ['.xlsx', '.xls', '.csv'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            
            if (!allowedTypes.includes(fileExtension)) {
                showNotification('Formato de arquivo n√£o suportado!', 'error');
                return;
            }

            const progressContainer = document.getElementById('importProgress');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            progressContainer.classList.remove('hidden');
            
            // Ler arquivo
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let dadosImportados = [];
                    
                    if (fileExtension === '.csv') {
                        // Processar CSV
                        const texto = e.target.result;
                        const linhas = texto.split('\n');
                        const cabecalho = linhas[0].toLowerCase().split(',').map(col => col.trim());
                        
                        // Mapear colunas obrigat√≥rias
                        const colSku = encontrarColuna(cabecalho, ['codigo', 'sku', 'code', 'id']);
                        const colNome = encontrarColuna(cabecalho, ['descricao', 'nome', 'produto', 'description']);
                        const colQuantidade = encontrarColuna(cabecalho, ['estoque', 'quantidade', 'qty', 'quantity', 'stock']);
                        
                        if (colSku === -1 || colNome === -1 || colQuantidade === -1) {
                            throw new Error('Colunas obrigat√≥rias n√£o encontradas. Verifique se a planilha cont√©m: Codigo, Descricao e Estoque');
                        }
                        
                        for (let i = 1; i < linhas.length && dadosImportados.length < 10000; i++) {
                            const linha = linhas[i].split(',').map(col => col.trim());
                            if (linha.length > 1 && linha[colNome] && linha[colSku]) {
                                dadosImportados.push({
                                    sku: linha[colSku],
                                    nome: linha[colNome],
                                    quantidade: parseInt(linha[colQuantidade]) || 0,
                                    valor: 0 // Valor padr√£o j√° que n√£o √© obrigat√≥rio
                                });
                            }
                        }
                        
                        // Verificar limite m√°ximo
                        if (dadosImportados.length >= 10000) {
                            showNotification('Limite de 10.000 produtos atingido. Apenas os primeiros 10.000 ser√£o importados.', 'warning');
                        }
                    } else {
                        // Para Excel, simular dados baseados no nome do arquivo
                        const nomes = ['Produto A', 'Produto B', 'Produto C', 'Produto D', 'Produto E'];
                        for (let i = 0; i < 5; i++) {
                            dadosImportados.push({
                                sku: `COD-${String(i + 1).padStart(3, '0')}`,
                                nome: nomes[i],
                                quantidade: Math.floor(Math.random() * 100) + 1,
                                valor: 0 // Valor padr√£o
                            });
                        }
                    }
                    
                    // Simular progresso
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += Math.random() * 25;
                        if (progress >= 100) {
                            progress = 100;
                            clearInterval(interval);
                            
                            // Adicionar produtos importados
                            let produtosAdicionados = 0;
                            const produtosParaConferencia = [];
                            
                            dadosImportados.forEach(item => {
                                // Verificar se SKU j√° existe
                                const produtoExistente = produtos.find(p => p.sku === item.sku);
                                
                                if (!produtoExistente) {
                                    const novoProduto = {
                                        id: Math.max(...produtos.map(p => p.id), 0) + 1 + produtosAdicionados,
                                        nome: item.nome,
                                        sku: item.sku,
                                        categoria: 'Importado',
                                        estoque: 0, // Iniciar com 0 para confer√™ncia
                                        estoqueMin: Math.max(Math.floor(item.quantidade * 0.2), 5),
                                        custo: item.valor || 0,
                                        status: 'critico'
                                    };
                                    
                                    produtos.unshift(novoProduto);
                                    produtosAdicionados++;
                                    
                                    // Adicionar √† lista de confer√™ncia
                                    produtosParaConferencia.push({
                                        sku: item.sku,
                                        nome: item.nome,
                                        quantidadeEsperada: item.quantidade
                                    });
                                } else {
                                    // Para produtos existentes, tamb√©m adicionar √† confer√™ncia
                                    produtosParaConferencia.push({
                                        sku: item.sku,
                                        nome: produtoExistente.nome,
                                        quantidadeEsperada: item.quantidade
                                    });
                                }
                            });
                            
                            // Iniciar confer√™ncia automaticamente com os produtos importados
                            if (produtosParaConferencia.length > 0) {
                                iniciarConferenciaComProdutos(produtosParaConferencia);
                            }
                            
                            // Registrar importa√ß√£o
                            const novaImportacao = {
                                id: importacoes.length + 1,
                                data: new Date().toISOString().replace('T', ' ').substring(0, 16),
                                tipo: fileExtension === '.csv' ? 'CSV' : 'Planilha Excel',
                                origem: file.name,
                                registros: dadosImportados.length,
                                status: 'Conclu√≠da'
                            };
                            
                            importacoes.unshift(novaImportacao);
                            
                            // Atualizar interfaces com dados recalculados
                            loadImportacao();
                            loadEstoque();
                            loadDashboard(); // Dashboard agora calcula com base nos dados importados
                            
                            progressContainer.classList.add('hidden');
                            showNotification(`${produtosAdicionados} produtos importados! Confer√™ncia iniciada automaticamente. V√° para a aba Confer√™ncia.`, 'success');
                        }
                        
                        progressBar.style.width = progress + '%';
                        progressText.textContent = `Processando... ${Math.round(progress)}%`;
                    }, 300);
                    
                } catch (error) {
                    progressContainer.classList.add('hidden');
                    showNotification(`Erro ao processar arquivo: ${error.message}`, 'error');
                }
            };
            
            if (fileExtension === '.csv') {
                reader.readAsText(file);
            } else {
                reader.readAsArrayBuffer(file);
            }
        }
        
        function encontrarColuna(cabecalho, possiveisNomes) {
            for (let i = 0; i < cabecalho.length; i++) {
                const coluna = cabecalho[i].toLowerCase();
                if (possiveisNomes.some(nome => coluna.includes(nome))) {
                    return i;
                }
            }
            return -1;
        }

        function downloadTemplate() {
            // Template com colunas obrigat√≥rias para importa√ß√£o
            const csvContent = "Codigo,Descricao,Estoque\nEX001,Produto Exemplo A,25\nEX002,Produto Exemplo B,15\nEX003,Produto Exemplo C,8";
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'template_produtos.csv';
            a.click();
            window.URL.revokeObjectURL(url);
            
            showNotification('Template baixado com sucesso! Use as colunas: Codigo, Descricao e Estoque', 'success');
        }

        function testarConexaoBling() {
            const apiKey = document.getElementById('blingApiKey').value;
            
            if (!apiKey) {
                showNotification('Insira a chave da API do Bling!', 'error');
                return;
            }
            
            // Simular teste de conex√£o
            showNotification('Testando conex√£o...', 'info');
            
            setTimeout(() => {
                document.getElementById('blingStatus').textContent = 'Conectado com sucesso';
                document.getElementById('blingIndicator').className = 'w-3 h-3 bg-green-500 rounded-full';
                document.getElementById('syncBlingBtn').disabled = false;
                document.getElementById('syncBlingBtn').className = 'w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700';
                
                showNotification('Conex√£o com Bling estabelecida!', 'success');
            }, 2000);
        }

        function sincronizarBling() {
            showNotification('Sincronizando com Bling...', 'info');
            
            // Simular sincroniza√ß√£o
            setTimeout(() => {
                const novaImportacao = {
                    id: importacoes.length + 1,
                    data: new Date().toISOString().replace('T', ' ').substring(0, 16),
                    tipo: 'API Bling',
                    origem: 'Sincroniza√ß√£o autom√°tica',
                    registros: Math.floor(Math.random() * 50) + 20,
                    status: 'Conclu√≠da'
                };
                
                importacoes.unshift(novaImportacao);
                loadImportacao();
                
                document.getElementById('lastSync').textContent = 'Agora mesmo';
                showNotification('Sincroniza√ß√£o com Bling conclu√≠da!', 'success');
            }, 3000);
        }

        // Relat√≥rios
        function gerarRelatorio(tipo) {
            const reportResult = document.getElementById('relatorioResult');
            const reportTitle = document.getElementById('relatorioTitle');
            const reportContent = document.getElementById('relatorioContent');
            
            let title = '';
            let content = '';
            
            switch(tipo) {
                case 'posicao':
                    title = 'Relat√≥rio de Posi√ß√£o de Estoque';
                    content = `
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left">Produto</th>
                                        <th class="px-4 py-2 text-left">SKU</th>
                                        <th class="px-4 py-2 text-left">Estoque</th>
                                        <th class="px-4 py-2 text-left">Valor Unit.</th>
                                        <th class="px-4 py-2 text-left">Valor Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${produtos.map(p => `
                                        <tr class="border-b">
                                            <td class="px-4 py-2">${p.nome}</td>
                                            <td class="px-4 py-2">${p.sku}</td>
                                            <td class="px-4 py-2">${p.estoque}</td>
                                            <td class="px-4 py-2">R$ ${p.custo.toFixed(2)}</td>
                                            <td class="px-4 py-2">R$ ${(p.estoque * p.custo).toFixed(2)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                    break;
                case 'movimentacao':
                    title = 'Relat√≥rio de Movimenta√ß√µes';
                    content = `
                        <div class="grid grid-cols-3 gap-4 mb-4">
                            <div class="bg-green-50 p-4 rounded-lg text-center">
                                <p class="text-sm text-green-600">Entradas</p>
                                <p class="text-2xl font-bold text-green-700">${movimentacoes.filter(m => m.tipo === 'entrada').length}</p>
                            </div>
                            <div class="bg-red-50 p-4 rounded-lg text-center">
                                <p class="text-sm text-red-600">Sa√≠das</p>
                                <p class="text-2xl font-bold text-red-700">${movimentacoes.filter(m => m.tipo === 'saida').length}</p>
                            </div>
                            <div class="bg-blue-50 p-4 rounded-lg text-center">
                                <p class="text-sm text-blue-600">Ajustes</p>
                                <p class="text-2xl font-bold text-blue-700">${movimentacoes.filter(m => m.tipo === 'ajuste').length}</p>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600">Per√≠odo: √öltimos 30 dias</p>
                    `;
                    break;
                case 'valorizado':
                    const valorTotal = produtos.reduce((total, p) => total + (p.estoque * p.custo), 0);
                    title = 'Relat√≥rio de Estoque Valorizado';
                    content = `
                        <div class="bg-blue-50 p-6 rounded-lg mb-4 text-center">
                            <p class="text-sm text-blue-600">Valor Total do Estoque</p>
                            <p class="text-3xl font-bold text-blue-700">R$ ${valorTotal.toFixed(2)}</p>
                        </div>
                        <div class="space-y-2">
                            ${produtos.map(p => `
                                <div class="flex justify-between items-center p-3 border rounded-lg">
                                    <span class="font-medium">${p.nome}</span>
                                    <span class="text-gray-600">R$ ${(p.estoque * p.custo).toFixed(2)}</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    break;
                default:
                    title = 'Relat√≥rio em Desenvolvimento';
                    content = '<p class="text-center text-gray-500 py-8">Este relat√≥rio est√° sendo desenvolvido.</p>';
            }
            
            reportTitle.textContent = title;
            reportContent.innerHTML = content;
            reportResult.classList.remove('hidden');
            
            showNotification('Relat√≥rio gerado com sucesso!', 'success');
        }

        function exportarRelatorio(formato) {
            showNotification(`Exportando relat√≥rio em ${formato.toUpperCase()}...`, 'info');
            
            setTimeout(() => {
                showNotification(`Relat√≥rio exportado em ${formato.toUpperCase()}!`, 'success');
            }, 1500);
        }

        // Fun√ß√µes auxiliares
        function getStatusProduto(produto) {
            if (produto.estoque === 0) return 'critico';
            if (produto.estoque <= produto.estoqueMin) return 'baixo';
            return 'ok';
        }

        function syncBling() {
            showNotification('Sincronizando com Bling...', 'info');
            
            setTimeout(() => {
                document.getElementById('lastSync').textContent = 'Agora mesmo';
                showNotification('Sincroniza√ß√£o conclu√≠da!', 'success');
            }, 2000);
        }

        // Modais
        function openModal(type) {
            const overlay = document.getElementById('modalOverlay');
            const content = document.getElementById('modalContent');
            
            let modalHTML = '';
            
            switch(type) {
                case 'novoProduto':
                    modalHTML = `
                        <h3 class="text-lg font-semibold mb-4">Novo Produto</h3>
                        <form onsubmit="criarProduto(event)">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Nome do Produto</label>
                                    <input type="text" name="nome" class="w-full px-3 py-2 border rounded-lg" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">SKU</label>
                                    <input type="text" name="sku" class="w-full px-3 py-2 border rounded-lg" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Categoria</label>
                                    <select name="categoria" class="w-full px-3 py-2 border rounded-lg" required>
                                        <option value="">Selecione uma categoria</option>
                                        <option value="Eletr√¥nicos">Eletr√¥nicos</option>
                                        <option value="Roupas">Roupas</option>
                                        <option value="Casa">Casa</option>
                                        <option value="Cal√ßados">Cal√ßados</option>
                                    </select>
                                </div>
                                <div class="grid grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Estoque</label>
                                        <input type="number" name="estoque" class="w-full px-3 py-2 border rounded-lg" min="0" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Est. M√≠n.</label>
                                        <input type="number" name="estoqueMin" class="w-full px-3 py-2 border rounded-lg" min="0" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Custo</label>
                                        <input type="number" name="custo" step="0.01" class="w-full px-3 py-2 border rounded-lg" min="0" required>
                                    </div>
                                </div>
                            </div>
                            <div class="flex justify-end space-x-3 mt-6">
                                <button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-600 border rounded-lg hover:bg-gray-50">Cancelar</button>
                                <button type="submit" class="px-4 py-2 gradient-bg text-white rounded-lg hover:opacity-90">Criar Produto</button>
                            </div>
                        </form>
                    `;
                    break;
                case 'ajusteEstoque':
                    modalHTML = `
                        <h3 class="text-lg font-semibold mb-4">Ajuste de Estoque</h3>
                        <form onsubmit="ajustarEstoqueModal(event)">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Produto</label>
                                    <select name="produto" class="w-full px-3 py-2 border rounded-lg" required>
                                        <option value="">Selecione um produto</option>
                                        ${produtos.map(p => `<option value="${p.id}">${p.nome} (${p.sku}) - Atual: ${p.estoque}</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Ajuste</label>
                                    <select name="tipo" class="w-full px-3 py-2 border rounded-lg" required>
                                        <option value="entrada">Entrada</option>
                                        <option value="saida">Sa√≠da</option>
                                        <option value="ajuste">Ajuste Manual</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Quantidade</label>
                                    <input type="number" name="quantidade" class="w-full px-3 py-2 border rounded-lg" min="1" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√µes</label>
                                    <textarea name="observacoes" class="w-full px-3 py-2 border rounded-lg" rows="3"></textarea>
                                </div>
                            </div>
                            <div class="flex justify-end space-x-3 mt-6">
                                <button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-600 border rounded-lg hover:bg-gray-50">Cancelar</button>
                                <button type="submit" class="px-4 py-2 gradient-bg text-white rounded-lg hover:opacity-90">Aplicar Ajuste</button>
                            </div>
                        </form>
                    `;
                    break;
                case 'novaMovimentacao':
                    modalHTML = `
                        <h3 class="text-lg font-semibold mb-4">Nova Movimenta√ß√£o</h3>
                        <form onsubmit="criarMovimentacao(event)">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Produto</label>
                                    <select name="produto" class="w-full px-3 py-2 border rounded-lg" required>
                                        <option value="">Selecione um produto</option>
                                        ${produtos.map(p => `<option value="${p.id}">${p.nome} (${p.sku})</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Tipo</label>
                                    <select name="tipo" class="w-full px-3 py-2 border rounded-lg" required>
                                        <option value="entrada">Entrada</option>
                                        <option value="saida">Sa√≠da</option>
                                        <option value="transferencia">Transfer√™ncia</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Quantidade</label>
                                    <input type="number" name="quantidade" class="w-full px-3 py-2 border rounded-lg" min="1" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Observa√ß√µes</label>
                                    <textarea name="observacoes" class="w-full px-3 py-2 border rounded-lg" rows="3" required></textarea>
                                </div>
                            </div>
                            <div class="flex justify-end space-x-3 mt-6">
                                <button type="button" onclick="closeModal()" class="px-4 py-2 text-gray-600 border rounded-lg hover:bg-gray-50">Cancelar</button>
                                <button type="submit" class="px-4 py-2 gradient-bg text-white rounded-lg hover:opacity-90">Criar Movimenta√ß√£o</button>
                            </div>
                        </form>
                    `;
                    break;
            }
            
            content.innerHTML = modalHTML;
            overlay.classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.add('hidden');
        }

        // Fun√ß√µes de cria√ß√£o
        function criarProduto(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            const novoProduto = {
                id: Math.max(...produtos.map(p => p.id)) + 1,
                nome: formData.get('nome'),
                sku: formData.get('sku'),
                categoria: formData.get('categoria'),
                estoque: parseInt(formData.get('estoque')),
                estoqueMin: parseInt(formData.get('estoqueMin')),
                custo: parseFloat(formData.get('custo')),
                status: 'ok'
            };
            
            novoProduto.status = getStatusProduto(novoProduto);
            produtos.unshift(novoProduto);
            
            loadEstoque();
            loadDashboard(); // Recalcular dashboard com novo produto
            closeModal();
            showNotification('Produto criado com sucesso!', 'success');
        }

        function ajustarEstoqueModal(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            const produtoId = parseInt(formData.get('produto'));
            const tipo = formData.get('tipo');
            const quantidade = parseInt(formData.get('quantidade'));
            const observacoes = formData.get('observacoes');
            
            const produto = produtos.find(p => p.id === produtoId);
            if (!produto) return;
            
            const estoqueAnterior = produto.estoque;
            let novoEstoque = estoqueAnterior;
            
            if (tipo === 'entrada') {
                novoEstoque += quantidade;
            } else if (tipo === 'saida') {
                novoEstoque -= quantidade;
            } else if (tipo === 'ajuste') {
                novoEstoque = quantidade;
            }
            
            if (novoEstoque < 0) {
                showNotification('Estoque n√£o pode ficar negativo!', 'error');
                return;
            }
            
            produto.estoque = novoEstoque;
            produto.status = getStatusProduto(produto);
            
            // Criar movimenta√ß√£o
            const novaMovimentacao = {
                id: movimentacoes.length + 1,
                data: new Date().toISOString().replace('T', ' ').substring(0, 16),
                produto: produto.nome,
                tipo: tipo,
                quantidade: tipo === 'ajuste' ? (novoEstoque - estoqueAnterior) : quantidade,
                estoqueAnterior: estoqueAnterior,
                estoqueAtual: novoEstoque,
                responsavel: 'Usu√°rio Atual',
                observacoes: observacoes || 'Ajuste manual'
            };
            
            movimentacoes.unshift(novaMovimentacao);
            
            loadEstoque();
            loadDashboard(); // Recalcular dashboard ap√≥s ajuste
            closeModal();
            showNotification('Ajuste aplicado com sucesso!', 'success');
        }

        function criarMovimentacao(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            const produtoId = parseInt(formData.get('produto'));
            const tipo = formData.get('tipo');
            const quantidade = parseInt(formData.get('quantidade'));
            const observacoes = formData.get('observacoes');
            
            const produto = produtos.find(p => p.id === produtoId);
            if (!produto) return;
            
            const estoqueAnterior = produto.estoque;
            let novoEstoque = estoqueAnterior;
            
            if (tipo === 'entrada') {
                novoEstoque += quantidade;
            } else if (tipo === 'saida') {
                if (estoqueAnterior < quantidade) {
                    showNotification('Estoque insuficiente!', 'error');
                    return;
                }
                novoEstoque -= quantidade;
            }
            
            produto.estoque = novoEstoque;
            produto.status = getStatusProduto(produto);
            
            const novaMovimentacao = {
                id: movimentacoes.length + 1,
                data: new Date().toISOString().replace('T', ' ').substring(0, 16),
                produto: produto.nome,
                tipo: tipo,
                quantidade: quantidade,
                estoqueAnterior: estoqueAnterior,
                estoqueAtual: novoEstoque,
                responsavel: 'Usu√°rio Atual',
                observacoes: observacoes
            };
            
            movimentacoes.unshift(novaMovimentacao);
            
            loadMovimentacao();
            loadDashboard(); // Recalcular dashboard ap√≥s movimenta√ß√£o
            closeModal();
            showNotification('Movimenta√ß√£o registrada com sucesso!', 'success');
        }

        // Configura√ß√µes
        function salvarConfiguracoes() {
            showNotification('Configura√ß√µes salvas com sucesso!', 'success');
        }

        function confirmarReset() {
            const modal = document.getElementById('modalOverlay');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <div class="text-center">
                    <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-red-600 text-2xl">‚ö†Ô∏è</span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Confirmar Reset do Sistema</h3>
                    <p class="text-gray-600 mb-6">
                        Tem certeza que deseja resetar todo o sistema? Esta a√ß√£o n√£o pode ser desfeita.
                        <br><br>
                        <strong>Todos os dados ser√£o perdidos permanentemente!</strong>
                    </p>
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                        <p class="text-sm text-yellow-800">
                            üí° <strong>Dica:</strong> Fa√ßa um backup antes de resetar o sistema se quiser preservar algum dado.
                        </p>
                    </div>
                    <div class="flex justify-center space-x-4">
                        <button onclick="closeModal()" class="px-6 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors">
                            Cancelar
                        </button>
                        <button onclick="resetarSistema()" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                            üóëÔ∏è Sim, Resetar Tudo
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        function resetarSistema() {
            showNotification('Resetando sistema...', 'info');
            
            // Capturar dados antes do reset para mostrar o que foi perdido
            const dadosAntesReset = {
                produtos: produtos.length,
                movimentacoes: movimentacoes.length,
                conferencias: conferencias.length,
                importacoes: importacoes.length,
                valorEstoque: produtos.reduce((total, p) => total + (p.estoque * p.custo), 0),
                produtosBaixo: produtos.filter(p => p.status === 'baixo').length,
                produtosCriticos: produtos.filter(p => p.status === 'critico').length
            };
            
            // Resetar todos os dados para valores iniciais
            setTimeout(() => {
                // Limpar produtos (manter apenas alguns exemplos)
                produtos = [
                    {id: 1, nome: 'Produto Exemplo A', sku: 'EX-001', categoria: 'Geral', estoque: 0, estoqueMin: 5, custo: 0.00, status: 'critico'},
                    {id: 2, nome: 'Produto Exemplo B', sku: 'EX-002', categoria: 'Geral', estoque: 0, estoqueMin: 5, custo: 0.00, status: 'critico'}
                ];
                
                // Limpar movimenta√ß√µes
                movimentacoes = [];
                
                // Limpar confer√™ncias
                conferencias = [];
                
                // Limpar importa√ß√µes
                importacoes = [];
                
                // Resetar confer√™ncia atual
                conferenciaAtual = {
                    ativa: false,
                    itens: [],
                    produtosConferidos: 0,
                    produtosCorretos: 0,
                    produtosDivergentes: 0
                };
                
                // Esconder confer√™ncia ativa se estiver vis√≠vel
                document.getElementById('conferenciaAtiva').classList.add('hidden');
                
                // Resetar configura√ß√µes do Bling
                document.getElementById('blingApiKey').value = '';
                document.getElementById('blingStatus').textContent = 'N√£o conectado';
                document.getElementById('blingIndicator').className = 'w-3 h-3 bg-red-500 rounded-full';
                document.getElementById('syncBlingBtn').disabled = true;
                document.getElementById('syncBlingBtn').className = 'w-full bg-gray-400 text-white py-2 rounded-lg cursor-not-allowed';
                
                // Resetar campos de configura√ß√£o
                document.getElementById('estoqueMinimo').value = '10';
                document.getElementById('diasVencimento').value = '30';
                document.getElementById('alertaEmail').checked = true;
                document.getElementById('alertaWhatsapp').checked = false;
                
                // Esconder relat√≥rio se estiver vis√≠vel
                document.getElementById('relatorioResult').classList.add('hidden');
                
                // Atualizar todas as interfaces
                loadDashboard();
                loadEstoque();
                loadConferencia();
                loadMovimentacao();
                loadImportacao();
                
                // Fechar modal
                closeModal();
                
                // Voltar para o dashboard
                showSection('dashboard');
                
                // Mostrar resumo do que foi perdido
                mostrarResumoReset(dadosAntesReset);
            }, 2000);
        }

        function mostrarResumoReset(dadosAntesReset) {
            const modal = document.getElementById('modalOverlay');
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <div class="text-center">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-green-600 text-2xl">‚úÖ</span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-4">Reset Conclu√≠do com Sucesso!</h3>
                    
                    <div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-6">
                        <h4 class="text-lg font-semibold text-red-800 mb-4">üìä Resumo dos Dados Removidos:</h4>
                        
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div class="bg-white p-3 rounded border">
                                <p class="text-gray-600">Produtos Cadastrados</p>
                                <p class="text-xl font-bold text-red-600">${dadosAntesReset.produtos}</p>
                            </div>
                            <div class="bg-white p-3 rounded border">
                                <p class="text-gray-600">Movimenta√ß√µes</p>
                                <p class="text-xl font-bold text-red-600">${dadosAntesReset.movimentacoes}</p>
                            </div>
                            <div class="bg-white p-3 rounded border">
                                <p class="text-gray-600">Confer√™ncias</p>
                                <p class="text-xl font-bold text-red-600">${dadosAntesReset.conferencias}</p>
                            </div>
                            <div class="bg-white p-3 rounded border">
                                <p class="text-gray-600">Importa√ß√µes</p>
                                <p class="text-xl font-bold text-red-600">${dadosAntesReset.importacoes}</p>
                            </div>
                        </div>
                        
                        <div class="mt-4 p-4 bg-red-100 rounded-lg">
                            <p class="text-sm text-red-700 mb-2"><strong>üí∞ Valor Total do Estoque Perdido:</strong></p>
                            <p class="text-2xl font-bold text-red-800">R$ ${dadosAntesReset.valorEstoque.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                        </div>
                        
                        ${dadosAntesReset.produtosBaixo > 0 || dadosAntesReset.produtosCriticos > 0 ? `
                        <div class="mt-4 p-3 bg-yellow-100 rounded-lg">
                            <p class="text-sm text-yellow-700">
                                <strong>‚ö†Ô∏è Alertas Removidos:</strong> 
                                ${dadosAntesReset.produtosBaixo} produtos com estoque baixo, 
                                ${dadosAntesReset.produtosCriticos} produtos cr√≠ticos
                            </p>
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                        <p class="text-sm text-green-700">
                            ‚ú® <strong>Sistema Limpo!</strong> Agora voc√™ pode come√ßar do zero com 2 produtos exemplo.
                            <br>Importe seus dados ou cadastre novos produtos para come√ßar.
                        </p>
                    </div>
                    
                    <button onclick="closeModal()" class="px-8 py-3 gradient-bg text-white rounded-lg hover:opacity-90 transition-opacity">
                        üöÄ Come√ßar do Zero
                    </button>
                </div>
            `;
            
            modal.classList.remove('hidden');
            
            // Mostrar notifica√ß√£o adicional
            showNotification('Sistema resetado! Confira o resumo dos dados removidos.', 'success');
        }

        function fazerBackup() {
            showNotification('Backup iniciado...', 'info');
            
            setTimeout(() => {
                showNotification('Backup conclu√≠do com sucesso!', 'success');
            }, 2000);
        }

        function restaurarBackup() {
            if (confirm('Tem certeza que deseja restaurar um backup? Todos os dados atuais ser√£o substitu√≠dos.')) {
                showNotification('Fun√ß√£o de restaura√ß√£o em desenvolvimento', 'info');
            }
        }

        // Gr√°ficos
        function loadCharts() {
            // Calcular dados reais das movimenta√ß√µes por dia
            const hoje = new Date();
            const diasSemana = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
            const dadosEntradas = [];
            const dadosSaidas = [];
            const labelsGrafico = [];
            
            // Gerar dados dos √∫ltimos 7 dias baseados nas movimenta√ß√µes reais
            for (let i = 6; i >= 0; i--) {
                const data = new Date(hoje);
                data.setDate(data.getDate() - i);
                const diaSemana = diasSemana[data.getDay()];
                labelsGrafico.push(diaSemana);
                
                // Contar movimenta√ß√µes do dia (simulado baseado nos dados existentes)
                const entradasDia = movimentacoes.filter(m => m.tipo === 'entrada').length + Math.floor(Math.random() * 10);
                const saidasDia = movimentacoes.filter(m => m.tipo === 'saida').length + Math.floor(Math.random() * 8);
                
                dadosEntradas.push(entradasDia);
                dadosSaidas.push(saidasDia);
            }

            // Gr√°fico de movimenta√ß√£o
            const movCtx = document.getElementById('movimentacaoChart');
            if (movCtx) {
                // Limpar gr√°fico anterior se existir
                Chart.getChart(movCtx)?.destroy();
                
                new Chart(movCtx, {
                    type: 'line',
                    data: {
                        labels: labelsGrafico,
                        datasets: [{
                            label: 'Entradas',
                            data: dadosEntradas,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4
                        }, {
                            label: 'Sa√≠das',
                            data: dadosSaidas,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // Calcular distribui√ß√£o real por categoria
            const categorias = {};
            produtos.forEach(produto => {
                if (categorias[produto.categoria]) {
                    categorias[produto.categoria]++;
                } else {
                    categorias[produto.categoria] = 1;
                }
            });
            
            const labelsCategorias = Object.keys(categorias);
            const dadosCategorias = Object.values(categorias);
            const coresCategorias = ['#10b981', '#3b82f6', '#f59e0b', '#ef4444', '#8b5cf6', '#06b6d4'];

            // Gr√°fico de categorias
            const catCtx = document.getElementById('categoriaChart');
            if (catCtx) {
                // Limpar gr√°fico anterior se existir
                Chart.getChart(catCtx)?.destroy();
                
                new Chart(catCtx, {
                    type: 'doughnut',
                    data: {
                        labels: labelsCategorias,
                        datasets: [{
                            data: dadosCategorias,
                            backgroundColor: coresCategorias.slice(0, labelsCategorias.length)
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

        // Notifica√ß√µes
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white z-50 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                type === 'warning' ? 'bg-yellow-500' :
                'bg-blue-500'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, type === 'warning' ? 5000 : 3000);
        }

        // Snake Game Logic
        let gameState = {
            snake: [{x: 150, y: 150}],
            food: {x: 75, y: 75},
            direction: {x: 15, y: 0},
            nextDirection: {x: 15, y: 0},
            score: 0,
            isPlaying: false,
            gameLoop: null
        };

        function initGame() {
            gameState.snake = [{x: 150, y: 150}];
            gameState.food = generateFood();
            gameState.direction = {x: 15, y: 0};
            gameState.nextDirection = {x: 15, y: 0};
            gameState.score = 0;
            updateScore();
            drawGame();
        }

        function generateFood() {
            const boardSize = 300;
            const pixelSize = 15;
            const maxPos = boardSize - pixelSize;
            
            let newFood;
            do {
                newFood = {
                    x: Math.floor(Math.random() * (maxPos / pixelSize)) * pixelSize,
                    y: Math.floor(Math.random() * (maxPos / pixelSize)) * pixelSize
                };
            } while (gameState.snake.some(segment => segment.x === newFood.x && segment.y === newFood.y));
            
            return newFood;
        }

        function drawGame() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';
            
            // Draw snake
            gameState.snake.forEach((segment, index) => {
                const pixel = document.createElement('div');
                pixel.className = 'snake-pixel';
                pixel.style.left = segment.x + 'px';
                pixel.style.top = segment.y + 'px';
                if (index === 0) {
                    pixel.style.background = '#059669'; // Head is darker
                }
                board.appendChild(pixel);
            });
            
            // Draw food
            const foodPixel = document.createElement('div');
            foodPixel.className = 'food-pixel';
            foodPixel.style.left = gameState.food.x + 'px';
            foodPixel.style.top = gameState.food.y + 'px';
            board.appendChild(foodPixel);
        }

        function moveSnake() {
            gameState.direction = gameState.nextDirection;
            const head = {...gameState.snake[0]};
            head.x += gameState.direction.x;
            head.y += gameState.direction.y;
            
            // Check wall collision
            if (head.x < 0 || head.x >= 300 || head.y < 0 || head.y >= 300) {
                gameOver();
                return;
            }
            
            // Check self collision
            if (gameState.snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                gameOver();
                return;
            }
            
            gameState.snake.unshift(head);
            
            // Check food collision
            if (head.x === gameState.food.x && head.y === gameState.food.y) {
                gameState.score += 10;
                updateScore();
                gameState.food = generateFood();
            } else {
                gameState.snake.pop();
            }
            
            drawGame();
        }

        function changeDirection(newDirection) {
            const directions = {
                'up': {x: 0, y: -15},
                'down': {x: 0, y: 15},
                'left': {x: -15, y: 0},
                'right': {x: 15, y: 0}
            };
            
            const dir = directions[newDirection];
            if (dir && 
                (dir.x !== -gameState.direction.x || dir.y !== -gameState.direction.y)) {
                gameState.nextDirection = dir;
            }
        }

        function toggleGame() {
            const playBtn = document.getElementById('playBtn');
            
            if (gameState.isPlaying) {
                // Pause game
                clearInterval(gameState.gameLoop);
                gameState.isPlaying = false;
                playBtn.textContent = '‚ñ∂Ô∏è';
            } else {
                // Start/Resume game
                if (gameState.snake.length === 1 && gameState.score === 0) {
                    initGame();
                }
                gameState.gameLoop = setInterval(moveSnake, 150);
                gameState.isPlaying = true;
                playBtn.textContent = '‚è∏Ô∏è';
            }
        }

        function gameOver() {
            clearInterval(gameState.gameLoop);
            gameState.isPlaying = false;
            document.getElementById('playBtn').textContent = 'üîÑ';
            
            setTimeout(() => {
                alert(`Game Over! Pontua√ß√£o: ${gameState.score}\nClique em üîÑ para jogar novamente!`);
            }, 100);
        }

        function updateScore() {
            document.getElementById('gameScore').textContent = gameState.score;
        }

        // Connection Monitoring
        let isOnline = navigator.onLine;
        let connectionCheckInterval;

        function updateConnectionStatus() {
            const statusElement = document.getElementById('connectionStatus');
            const offlineGame = document.getElementById('offlineGame');
            
            if (navigator.onLine) {
                statusElement.textContent = 'üü¢ Online';
                statusElement.className = 'connection-status online';
                if (!isOnline) {
                    // Just came back online
                    hideOfflineGame();
                }
                isOnline = true;
            } else {
                statusElement.textContent = 'üî¥ Offline';
                statusElement.className = 'connection-status offline';
                if (isOnline) {
                    // Just went offline
                    showOfflineGame();
                }
                isOnline = false;
            }
        }

        function showOfflineGame() {
            document.getElementById('offlineGame').style.display = 'flex';
            initGame();
        }

        function hideOfflineGame() {
            const offlineGame = document.getElementById('offlineGame');
            offlineGame.style.display = 'none';
            
            // Stop game if playing
            if (gameState.isPlaying) {
                clearInterval(gameState.gameLoop);
                gameState.isPlaying = false;
            }
        }

        // Keyboard controls for game
        document.addEventListener('keydown', function(e) {
            const gameVisible = document.getElementById('offlineGame').style.display === 'flex';
            
            if (gameVisible) {
                switch(e.key) {
                    case 'ArrowUp':
                        e.preventDefault();
                        changeDirection('up');
                        break;
                    case 'ArrowDown':
                        e.preventDefault();
                        changeDirection('down');
                        break;
                    case 'ArrowLeft':
                        e.preventDefault();
                        changeDirection('left');
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        changeDirection('right');
                        break;
                    case ' ':
                        e.preventDefault();
                        toggleGame();
                        break;
                    case 'Escape':
                        e.preventDefault();
                        if (isOnline) {
                            hideOfflineGame();
                        }
                        break;
                }
            }
        });

        // Enhanced processarArquivo with loading states
        function processarArquivoComLoading(file) {
            // Show loading state
            showDashboardLoading();
            
            // Process file with delay to show loading
            setTimeout(() => {
                processarArquivo(file);
            }, 1000);
        }

        function showDashboardLoading() {
            document.getElementById('dashboardLoading').classList.remove('hidden');
            document.getElementById('dashboardContent').classList.add('hidden');
        }

        function hideDashboardLoading() {
            document.getElementById('dashboardLoading').classList.add('hidden');
            document.getElementById('dashboardContent').classList.remove('hidden');
        }

        // Override original processarArquivo to use loading version
        const originalProcessarArquivo = processarArquivo;
        processarArquivo = function(file) {
            const allowedTypes = ['.xlsx', '.xls', '.csv'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            
            if (!allowedTypes.includes(fileExtension)) {
                showNotification('Formato de arquivo n√£o suportado!', 'error');
                return;
            }

            const progressContainer = document.getElementById('importProgress');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            progressContainer.classList.remove('hidden');
            
            // Ler arquivo
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let dadosImportados = [];
                    
                    if (fileExtension === '.csv') {
                        // Processar CSV
                        const texto = e.target.result;
                        const linhas = texto.split('\n');
                        const cabecalho = linhas[0].toLowerCase().split(',').map(col => col.trim());
                        
                        // Mapear colunas obrigat√≥rias
                        const colSku = encontrarColuna(cabecalho, ['codigo', 'sku', 'code', 'id']);
                        const colNome = encontrarColuna(cabecalho, ['descricao', 'nome', 'produto', 'description']);
                        const colQuantidade = encontrarColuna(cabecalho, ['estoque', 'quantidade', 'qty', 'quantity', 'stock']);
                        
                        if (colSku === -1 || colNome === -1 || colQuantidade === -1) {
                            throw new Error('Colunas obrigat√≥rias n√£o encontradas. Verifique se a planilha cont√©m: Codigo, Descricao e Estoque');
                        }
                        
                        for (let i = 1; i < linhas.length && dadosImportados.length < 10000; i++) {
                            const linha = linhas[i].split(',').map(col => col.trim());
                            if (linha.length > 1 && linha[colNome] && linha[colSku]) {
                                dadosImportados.push({
                                    sku: linha[colSku],
                                    nome: linha[colNome],
                                    quantidade: parseInt(linha[colQuantidade]) || 0,
                                    valor: 0 // Valor padr√£o j√° que n√£o √© obrigat√≥rio
                                });
                            }
                        }
                        
                        // Verificar limite m√°ximo
                        if (dadosImportados.length >= 10000) {
                            showNotification('Limite de 10.000 produtos atingido. Apenas os primeiros 10.000 ser√£o importados.', 'warning');
                        }
                    } else {
                        // Para Excel, simular dados baseados no nome do arquivo
                        const nomes = ['Produto A', 'Produto B', 'Produto C', 'Produto D', 'Produto E'];
                        for (let i = 0; i < 5; i++) {
                            dadosImportados.push({
                                sku: `COD-${String(i + 1).padStart(3, '0')}`,
                                nome: nomes[i],
                                quantidade: Math.floor(Math.random() * 100) + 1,
                                valor: 0 // Valor padr√£o
                            });
                        }
                    }
                    
                    // Simular progresso
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += Math.random() * 25;
                        if (progress >= 100) {
                            progress = 100;
                            clearInterval(interval);
                            
                            // Show dashboard loading while processing
                            showDashboardLoading();
                            
                            // Process data after a delay
                            setTimeout(() => {
                                // Adicionar produtos importados
                                let produtosAdicionados = 0;
                                const produtosParaConferencia = [];
                                
                                dadosImportados.forEach(item => {
                                    // Verificar se SKU j√° existe
                                    const produtoExistente = produtos.find(p => p.sku === item.sku);
                                    
                                    if (!produtoExistente) {
                                        const novoProduto = {
                                            id: Math.max(...produtos.map(p => p.id), 0) + 1 + produtosAdicionados,
                                            nome: item.nome,
                                            sku: item.sku,
                                            categoria: 'Importado',
                                            estoque: 0, // Iniciar com 0 para confer√™ncia
                                            estoqueMin: Math.max(Math.floor(item.quantidade * 0.2), 5),
                                            custo: item.valor || 0,
                                            status: 'critico'
                                        };
                                        
                                        produtos.unshift(novoProduto);
                                        produtosAdicionados++;
                                        
                                        // Adicionar √† lista de confer√™ncia
                                        produtosParaConferencia.push({
                                            sku: item.sku,
                                            nome: item.nome,
                                            quantidadeEsperada: item.quantidade
                                        });
                                    } else {
                                        // Para produtos existentes, tamb√©m adicionar √† confer√™ncia
                                        produtosParaConferencia.push({
                                            sku: item.sku,
                                            nome: produtoExistente.nome,
                                            quantidadeEsperada: item.quantidade
                                        });
                                    }
                                });
                                
                                // Hide dashboard loading
                                hideDashboardLoading();
                                
                                // Iniciar confer√™ncia automaticamente com os produtos importados
                                if (produtosParaConferencia.length > 0) {
                                    iniciarConferenciaComProdutos(produtosParaConferencia);
                                }
                                
                                // Registrar importa√ß√£o
                                const novaImportacao = {
                                    id: importacoes.length + 1,
                                    data: new Date().toISOString().replace('T', ' ').substring(0, 16),
                                    tipo: fileExtension === '.csv' ? 'CSV' : 'Planilha Excel',
                                    origem: file.name,
                                    registros: dadosImportados.length,
                                    status: 'Conclu√≠da'
                                };
                                
                                importacoes.unshift(novaImportacao);
                                
                                // Atualizar interfaces com dados recalculados
                                loadImportacao();
                                loadEstoque();
                                loadDashboard(); // Dashboard agora calcula com base nos dados importados
                                
                                progressContainer.classList.add('hidden');
                                showNotification(`${produtosAdicionados} produtos importados! Confer√™ncia iniciada automaticamente. Dashboard atualizado com as novas informa√ß√µes.`, 'success');
                            }, 2000); // 2 second delay to show loading
                        }
                        
                        progressBar.style.width = progress + '%';
                        progressText.textContent = `Processando... ${Math.round(progress)}%`;
                    }, 300);
                    
                } catch (error) {
                    progressContainer.classList.add('hidden');
                    hideDashboardLoading();
                    showNotification(`Erro ao processar arquivo: ${error.message}`, 'error');
                }
            };
            
            if (fileExtension === '.csv') {
                reader.readAsText(file);
            } else {
                reader.readAsArrayBuffer(file);
            }
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            showSection('dashboard');
            
            // Initialize connection monitoring
            updateConnectionStatus();
            
            // Check connection every 5 seconds
            connectionCheckInterval = setInterval(updateConnectionStatus, 5000);
            
            // Listen for online/offline events
            window.addEventListener('online', updateConnectionStatus);
            window.addEventListener('offline', updateConnectionStatus);
            
            // Initialize game
            initGame();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'968874f0161e7e11',t:'MTc1NDA4NDAzNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
